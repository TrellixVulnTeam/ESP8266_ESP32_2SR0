#	appWeb.conf -- Default Configuration for the AppWeb HTTP Server for GoLinux
#	
#	This configuration file controls the operation of the AppWeb 
#	server. The order of configuration directives matters as this 
#	file is parsed only once. You must put the server root and error 
#	log definitions first to ensure configuration errors are logged.

#	Root directory for AppWeb to find necessary files and DLLs. 
#	AppWeb will change directory to this location when it runs.
ServerRoot "/active/WWW/"

#	The log level can be a number between 0 and 9 (most verbose level).
LogLevel 0

#	Location for documents for the primary server host. Virtual hosts 
#	may define their own DocumentRoot directives.
DocumentRoot "webpages/"

#	Bind AppWeb to listen for incoming requests on this address. 
#	Formats include (IP, IP:PORT, PORT). If an IP address is omitted, 
#	AppWeb will listen on all interfaces. If a port is omitted, then 
#	port 80 is used.
Listen	80

#	This will listen on port 443 for SSL requests
Listen	443

#	This will listen on port 8443 for SSL requests
Listen	8443
Listen	4443

#	Location of the mime translation file to map content types to 
#	file extensions.
TypesConfig "mime.types"

#Direct to index.lp when 404 error occur
ErrorDocument 404 index.lp

AddHandler xAuthHandler .lp .ini .gz .lua .llp .htm .html
AddHandler luaHandler .lp .lua .llp
#   AddHandler luaHandler .lp .lua .llp .htm .html

AddHandler copyHandler 

<Location /RequestData>
        SetHandler xAuthHandler 
        SetHandler luaHandler
</Location>

<Location /SIPGwCallLog>
        SetHandler xAuthHandler 
        SetHandler luaHandler
</Location>

<Location /SIPGwConfig>
        SetHandler xAuthHandler 
        SetHandler luaHandler
</Location>
#Fix for CPE_P00115630-AGConfig.ini available to download - undocumented files accessible
#Alias /AGConfig.ini "/dl/user.ini"
Alias /dl/syslog.txt "/dl/syslog.txt"
Alias /tmp/router.bin "/tmp/router.bin"
Alias /AGConfig.kry "/tmp/AGConfig.kry"
Alias /AGConfig.cfg "/tmp/AGConfig.cfg"
Alias /AGConfig.xml "/tmp/AGConfig.xml"
Alias /Widget.kry "/tmp/Widget.kry"
Alias /Widget.xml "/tmp/Widget.xml"
Alias /var/usbmount "/var/usbmount"

LuaMBUSDatamodel "atomic_device"

#
#       xAuthConfiguration
# TI require no session time out, so set it to 7 days
xAuthSessionTimeout 10
#xAuthDefaultUser 1
xAuthDefaultUserFallback 1
xAuthType "InGUI"  
xAuthInGUILoginPage "/index_auth.lp"
#xAuthType "Digest"


# 	Define persisten connections where one TCP/IP connection may serve
#	multiple HTTP requests. (A definite performance boost)
KeepAlive on
SendBufferSize 32768

#	Number of seconds to wait for the next HTTP request before closing 
#	the TCP/IP connection.
KeepAliveTimeout 60

#	Number of HTTP requests to accept on a single TCP/IP connection
MaxKeepAliveRequests 2000

#	Send and receive inactivity timeout to close a TCP/IP connection
Timeout 60

#	Default directory index to serve when a directory (URL ends in "/")
#	is requested.
DirectoryIndex	""
RootIndex	index.lp	

#	Comment out this section if you do not want to use SSL
#	This virtual host will process SSL requests on port 443
<VirtualHost *:443>
    DocumentRoot "agconfig/"
    SSLEngine on
    SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL
	#MUST not use ssl2
    SSLProtocol ALL -SSLV2

    #
    #	WARNING: you must regenerate the server.crt and server.key.pem
    #
    #SSLCertificateFile "/dl/tls/cert0001.pem"
    SSLCertificateFile "./certAG_b64_pem.cer"

    #
    #	WARNING: we are using the decrypted key here so it won't prompt for the
    #	password. Replace with server.key for higher security
    #
	# RSA Private key file
    #SSLCertificateKeyFile "/dl/tls/pkey0001.pem"
    SSLCertificateKeyFile "./keyAG.pem"

    # Add these directives to verify client certificates
    SSLVerifyClient require
    SSLCACertificateFile "../rootTLC-CA.cer"
    #SSLCACertificatePath "$SERVER_ROOT/certs"
</VirtualHost>

#   This virtual host will process SSL requests on port 8443
<VirtualHost *:8443>
    DocumentRoot "widget/"
    SSLEngine on
    SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL
    #MUST not use ssl2
    SSLProtocol ALL -SSLV2
    SSLCertificateFile "./certAG_b64_pem.cer"
    SSLCertificateKeyFile "./keyAG.pem"
</VirtualHost>

<VirtualHost *:4443>
    DocumentRoot "webpages/"
    SSLEngine on
    SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL
    #MUST not use ssl2
    SSLProtocol ALL -SSLV2
    SSLCertificateFile "/dl/tls/remote_access_cert.pem"
    SSLCertificateKeyFile "/dl/tls/remote_access_key.pem"
</VirtualHost>

# Appweb configured with 10 threads
ThreadLimit 10

# Start all threads at startup of the webserver
StartThreads 10


# The request body is limited to 2GB
LimitRequestBody 2147483647
# Listen-port is hardcoded in appweb ServiceMgr registration
Listen	9000

<VirtualHost *:9000>
    DocumentRoot "docroot_xmlcom/"
    SSLEngine on
    SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL
	#MUST not use ssl2
    SSLProtocol ALL -SSLV2

    SSLCertificateFile "/dl/tls/cert0001.pem"
    # RSA Private key
    SSLCertificateKeyFile "/dl/tls/pkey0001.pem"
    
    # CA verification
    SSLVerifyClient require
    SSLCACertificateFile "../portalpubkey.pem"
</VirtualHost>

# Listen-port is hardcoded in appweb ServiceMgr registration
Listen	127.0.0.1:9001

<VirtualHost *:9001>
    DocumentRoot "vhost_rg/"
</VirtualHost>

