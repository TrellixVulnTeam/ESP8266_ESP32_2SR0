#!/bin/sh

# Usage: ./copyconfig from_id to_id
# This script copies the configuration files of one bank to another. It skips the file version.info.

DEBUG=1
#DEBUG=0

info()
{
	if [ $DEBUG -gt 0 ]; then
		echo "`basename $0`: $@"
	fi
}

usage()
{
	echo "Usage: `basename $0` from_id to_id"
}

from_id=$1
to_id=$2

if [ -z "$from_id" -o -z "$to_id" ]; then
	usage
	exit 1
fi

from_dir="/userfs/config-bank-$from_id/"
to_dir="/userfs/config-bank-$to_id/"

#Bail out if $from_dir does not exist
if [ ! -d $from_dir ]; then
	echo "Configuration directory '$from_dir' does not exist."
	exit 1
fi

#Create to_dir if it does not exist
[ ! -d $to_dir ] && mkdir $to_dir

#Clean to_dir
(cd $to_dir && rm -Rf *)

#Copy configuration
info "Copying configuration from bank $from_id to bank $to_id"
for i in $(ls $from_dir | grep -v "^version$"); do
	cp -a $from_dir$i $to_dir
done

exit 0

